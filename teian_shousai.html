<!DOCTYPE html>

<html lang="ja">



<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>æ¥­å‹™ç”¨å‹¤æ€ æ‰“åˆ»ã‚·ã‚¹ãƒ†ãƒ  è¨­è¨ˆè³‡æ–™ v3.4</title>

    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>

    <script>

        document.addEventListener("DOMContentLoaded", function () {

            mermaid.initialize({

                startOnLoad: true,

                theme: 'base',

                themeVariables: {

                    primaryColor: '#e0e7ff',

                    edgeLabelBackground: '#ffffff',

                    tertiaryColor: '#f3e8ff'

                }

            });

        });

    </script>

    <style>
        :root {

            --primary-gradient: linear-gradient(135deg, #1e40af 0%, #4c1d95 100%);

            --primary-color: #1e40af;

            --accent-color: #6d28d9;

            --text-main: #1f2937;

            --text-light: #6b7280;

            --bg-body: #f3f4f6;

            --bg-card: #ffffff;

            --code-bg: #1e293b;

            --code-text: #e2e8f0;

        }



        * {

            margin: 0;

            padding: 0;

            box-sizing: border-box;

        }



        body {

            font-family: 'Segoe UI', 'Hiragino Sans', 'Yu Gothic', sans-serif;

            line-height: 1.8;

            color: var(--text-main);

            background: var(--bg-body);

            padding: 20px;

        }



        .container {

            max-width: 1200px;

            margin: 0 auto;

            background: var(--bg-card);

            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);

            border-radius: 16px;

            overflow: hidden;

        }



        header {

            background: var(--primary-gradient);

            color: white;

            padding: 60px 40px;

            text-align: center;

        }



        header h1 {

            font-size: 2.2em;

            margin-bottom: 10px;

            font-weight: 700;

        }



        header p {

            font-size: 1.1em;

            opacity: 0.9;

        }



        .content {

            padding: 40px;

        }



        section {

            margin-bottom: 60px;

        }



        h2 {

            color: var(--primary-color);

            font-size: 1.8em;

            margin-bottom: 25px;

            padding-bottom: 10px;

            border-bottom: 2px solid #e5e7eb;

            display: flex;

            align-items: center;

            gap: 10px;

        }



        h3 {

            color: var(--accent-color);

            font-size: 1.4em;

            margin: 35px 0 15px 0;

        }



        .overview-grid,

        .tech-stack {

            display: grid;

            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));

            gap: 20px;

            margin: 20px 0;

        }



        .card {

            background: #f9fafb;

            padding: 25px;

            border-radius: 12px;

            border: 1px solid #e5e7eb;

            border-left: 4px solid var(--primary-color);

            transition: transform 0.2s;

            margin-bottom: 20px;

        }



        .card:hover {

            transform: translateY(-2px);

            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);

        }



        .card h4 {

            color: var(--primary-color);

            margin-bottom: 10px;

            font-size: 1.1em;

        }



        .tech-item {

            background: linear-gradient(135deg, #eef2ff 0%, #f5f3ff 100%);

            color: var(--text-main);

            padding: 20px;

            border-radius: 12px;

            text-align: center;

            border: 1px solid #e0e7ff;

        }



        .tech-item h4 {

            color: var(--primary-color);

            margin-bottom: 10px;

            font-weight: bold;

        }



        /* Diagrams & Code */

        .diagram-container {

            background: white;

            padding: 20px;

            border: 1px solid #e5e7eb;

            border-radius: 12px;

            margin: 20px 0;

            overflow-x: auto;

            text-align: center;

        }



        .code-block {

            background: var(--code-bg);

            color: var(--code-text);

            padding: 20px;

            border-radius: 8px;

            font-family: 'Consolas', 'Monaco', monospace;

            font-size: 0.9em;

            overflow-x: auto;

            margin: 15px 0;

            line-height: 1.5;

            border-left: 4px solid #10b981;

            /* å·¦ç«¯ã®ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆã‚’ç„¡è¦–ã—ã¦è¡¨ç¤º */

            white-space: pre;

            text-align: left;

        }



        /* Tables */

        .table-responsive {

            overflow-x: auto;

            border-radius: 8px;

            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);

            margin: 20px 0;

        }



        table {

            width: 100%;

            border-collapse: collapse;

            min-width: 600px;

        }



        th {

            background: var(--primary-color);

            color: white;

            padding: 15px;

            text-align: left;

            font-weight: 600;

        }



        td {

            padding: 12px 15px;

            border-bottom: 1px solid #e5e7eb;

            background: white;

        }



        tr:last-child td {

            border-bottom: none;

        }



        tr:hover td {

            background: #f9fafb;

        }



        /* Lists & Alerts */

        .security-list {

            background: #fffbeb;

            border-left: 4px solid #f59e0b;

            padding: 20px;

            border-radius: 6px;

            margin: 20px 0;

        }



        .security-list h3 {

            color: #92400e;

            margin-top: 0;

            font-size: 1.1em;

        }



        .benefit-box {

            background: #ecfdf5;

            border: 1px solid #d1fae5;

            border-radius: 8px;

            padding: 20px;

            margin: 20px 0;

        }



        .note {

            background: #eff6ff;

            border-left: 4px solid #3b82f6;

            padding: 15px 20px;

            margin: 20px 0;

            border-radius: 4px;

            color: #1e3a8a;

        }



        .warning {

            background: #fff5f5;

            border-left: 4px solid #ef4444;

            padding: 15px 20px;

            margin: 20px 0;

            border-radius: 4px;

            color: #991b1b;

        }



        /* UI Mockup Styles */

        .mockup-container {

            display: flex;

            flex-wrap: wrap;

            gap: 30px;

            justify-content: center;

            margin: 30px 0;

        }



        .smartphone {

            width: 280px;

            height: 550px;

            border: 12px solid #333;

            border-radius: 30px;

            background: #fff;

            position: relative;

            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);

            overflow: hidden;

            display: flex;

            flex-direction: column;

        }



        .smartphone-header {

            background: #1e40af;

            color: white;

            padding: 15px 10px;

            font-size: 0.9em;

            text-align: center;

            font-weight: bold;

        }



        .smartphone-body {

            flex: 1;

            padding: 20px;

            display: flex;

            flex-direction: column;

            align-items: center;

            justify-content: center;

            background: #f8fafc;

        }



        .ui-time {

            font-size: 2.5em;

            font-weight: bold;

            color: #333;

            margin-bottom: 20px;

            font-family: monospace;

        }



        .ui-btn {

            width: 180px;

            height: 180px;

            border-radius: 50%;

            border: none;

            color: white;

            font-size: 1.5em;

            font-weight: bold;

            cursor: pointer;

            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);

            display: flex;

            flex-direction: column;

            align-items: center;

            justify-content: center;

            transition: transform 0.1s;

        }



        .ui-btn:active {

            transform: scale(0.95);

        }



        .ui-btn.in {

            background: linear-gradient(135deg, #3b82f6, #2563eb);

        }



        .ui-btn.out {

            background: linear-gradient(135deg, #ef4444, #dc2626);

        }



        .ui-link {

            margin-top: 20px;

            color: #3b82f6;

            text-decoration: underline;

            font-size: 0.9em;

            cursor: pointer;

        }



        .ui-modal {

            position: absolute;

            bottom: 0;

            left: 0;

            width: 100%;

            height: 60%;

            background: white;

            border-top-left-radius: 20px;

            border-top-right-radius: 20px;

            box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.1);

            padding: 20px;

            display: flex;

            flex-direction: column;

        }



        .ui-input-group {

            margin-bottom: 15px;

            text-align: left;

            width: 100%;

        }



        .ui-label {

            font-size: 0.8em;

            color: #666;

            margin-bottom: 5px;

            display: block;

        }



        .ui-input {

            width: 100%;

            padding: 8px;

            border: 1px solid #ddd;

            border-radius: 4px;

            font-size: 1em;

        }



        .ui-btn-submit {

            background: #1e40af;

            color: white;

            border: none;

            padding: 10px;

            border-radius: 6px;

            margin-top: auto;

            font-weight: bold;

        }



        .ui-login-btn {

            background: white;

            border: 1px solid #ddd;

            padding: 10px 20px;

            border-radius: 4px;

            display: flex;

            align-items: center;

            gap: 10px;

            font-weight: bold;

            color: #333;

            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);

        }



        footer {

            background: #1f2937;

            color: #9ca3af;

            text-align: center;

            padding: 30px;

            margin-top: 40px;

            border-top: 1px solid #374151;

        }



        .badge {

            display: inline-block;

            padding: 2px 8px;

            border-radius: 99px;

            font-size: 0.75em;

            font-weight: bold;

            background: #fee2e2;

            color: #991b1b;

        }



        .badge.new {

            background: #dbeafe;

            color: #1e40af;

        }



        @media (max-width: 768px) {

            header {

                padding: 30px 15px;

            }



            header h1 {

                font-size: 1.4em;

            }



            header p {

                font-size: 0.95em;

            }



            .content {

                padding: 15px;

            }



            h2 {

                font-size: 1.3em;

                flex-wrap: wrap;

            }



            h3 {

                font-size: 1.15em;

            }



            .card {

                padding: 15px;

            }



            .code-block {

                padding: 12px;

                font-size: 0.75em;

                border-radius: 6px;

            }



            table {

                min-width: unset;

                font-size: 0.85em;

            }



            th,
            td {

                padding: 8px 10px;

            }



            .overview-grid,

            .tech-stack {

                grid-template-columns: 1fr;

                gap: 12px;

            }



            .diagram-container {

                padding: 10px;

            }



            .mockup-container {

                flex-direction: column;

                align-items: center;

                gap: 20px;

            }



            .smartphone {

                width: 260px;

                height: 500px;

            }



            section {

                margin-bottom: 40px;

            }



            .note,
            .warning,
            .security-list {

                padding: 12px 15px;

            }

        }

        @media (max-width: 480px) {

            body {

                padding: 8px;

            }



            .container {

                border-radius: 8px;

            }



            header {

                padding: 25px 12px;

            }



            header h1 {

                font-size: 1.2em;

            }



            .content {

                padding: 12px;

            }



            h2 {

                font-size: 1.15em;

            }



            .code-block {

                font-size: 0.7em;

                padding: 10px;

            }



            table {

                font-size: 0.8em;

            }



            th,
            td {

                padding: 6px 8px;

            }

        }
    </style>

</head>



<body>

    <div class="container">

        <header>

            <h1>ğŸ• æ¥­å‹™ç”¨å‹¤æ€ æ‰“åˆ»ã‚·ã‚¹ãƒ†ãƒ  v3.4</h1>

            <p>è©³ç´°è¨­è¨ˆ - ã‚¢ãƒ—ãƒªå®Ÿè£…ToDoå®Œå…¨ç‰ˆ</p>

        </header>



        <div class="content">

            <section>

                <h2>ğŸ“‹ ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦</h2>

                <p>å¾“æ¥­å“¡ãŒã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã‚¢ãƒ—ãƒªã‹ã‚‰ç°¡å˜ã«å‹¤æ€ æ‰“åˆ»ã‚’è¡Œãˆã‚‹ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚åŸºæœ¬ã¯1ã‚¿ãƒƒãƒ—ã®ç¾åœ¨æ™‚åˆ»æ‰“åˆ»ã§ã™ãŒã€<strong>æ‰“åˆ»å¿˜ã‚Œæ™‚ãªã©ã«å‚™ãˆã¦æ™‚åˆ»ã®æ‰‹å‹•æŒ‡å®šã‚‚å¯èƒ½</strong>ã§ã™ã€‚</p>



                <div class="overview-grid">

                    <div class="card">

                        <h4>ğŸ¯ ä¸»ãªç›®çš„</h4>

                        <p>å‹¤æ€ ç®¡ç†ã®åŠ¹ç‡åŒ–ã¨ã€ãƒãƒ¼ãƒ å†…ã§ã®å‡ºé€€å‹¤çŠ¶æ³ã®å¯è¦–åŒ–ã‚’å®Ÿç¾ã—ã¾ã™ã€‚</p>

                    </div>

                    <div class="card">

                        <h4>ğŸ“± å¯¾è±¡ãƒ‡ãƒã‚¤ã‚¹</h4>

                        <p>iOS / Android ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã‚¢ãƒ—ãƒª</p>

                    </div>

                    <div class="card">

                        <h4>ğŸ‘¥ æƒ³å®šãƒ¦ãƒ¼ã‚¶ãƒ¼</h4>

                        <p>å…¨å¾“æ¥­å“¡ ç´„50åä»¥ä¸‹ï¼ˆã‚ªãƒ•ã‚£ã‚¹å‹¤å‹™ãƒ»ãƒªãƒ¢ãƒ¼ãƒˆå‹¤å‹™å•ã‚ãšï¼‰</p>

                    </div>

                    <div class="card">

                        <h4>âš¡ æ“ä½œã®ç°¡ä¾¿æ€§</h4>

                        <p>é€šå¸¸ã¯1ã‚¿ãƒƒãƒ—å®Œäº†ã€‚å¿…è¦ã«å¿œã˜ã¦ã€Œæ™‚åˆ»å¤‰æ›´ã€ã‚‚å¯èƒ½ãªæŸ”è»Ÿãªé‹ç”¨ã€‚</p>

                    </div>

                </div>

            </section>



            <section>

                <h2>ğŸ—ï¸ ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“æ§‹æˆå›³ (Zero Trust + Docker + DB Job Queue)</h2>

                <p>Cloudflare Tunnelã«ã‚ˆã‚‹ã‚»ã‚­ãƒ¥ã‚¢ãªæ¥ç¶šã¨ã€<strong>Dockerã‚³ãƒ³ãƒ†ãƒŠã§ç®¡ç†ã•ã‚ŒãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»DB</strong>ã€<strong>PostgreSQLã‚’ç”¨ã„ãŸå …ç‰¢ãªã‚¸ãƒ§ãƒ–ç®¡ç†</strong>ã‚’çµ„ã¿åˆã‚ã›ãŸæ§‹æˆã§ã™ã€‚</p>



                <div class="diagram-container">

                    <div class="mermaid">

                        graph TD

                        subgraph Client["ğŸ“± ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰"]

                        App["ã‚¹ãƒãƒ›ã‚¢ãƒ—ãƒª<br>Service Tokenä¿æŒ"]

                        end

                        subgraph Cloud["â˜ï¸ Cloudflare Edge Network"]

                        CF_DNS["DNS / CDN"]

                        CF_WAF["WAF / DDoSå¯¾ç­–"]

                        CF_Access["Zero Trust Access"]

                        end

                        subgraph OnPrem["ğŸ¢ ç¤¾å†…ã‚ªãƒ³ãƒ—ãƒ¬ãƒŸã‚¹ç’°å¢ƒ"]

                        Tunneld["cloudflared<br>(Connector)"]

                        Firewall["ğŸ”¥ Firewall<br>Inboundå…¨æ‹’å¦"]

                        subgraph Docker["ğŸ³ Docker Compose"]

                        Spring["â˜• Spring Boot App<br>Port: 8080"]

                        DB[("ğŸ—„ï¸ PostgreSQL<br>App Data + Job Queue")]

                        end

                        end

                        subgraph External["ğŸŒ å¤–éƒ¨API"]

                        Google["ğŸ” Google OAuth"]

                        Slack["ğŸ’¬ Slack API"]

                        Freee["ğŸ“Š freee API"]

                        end

                        App -->|"HTTPS + Service Token"| CF_DNS

                        CF_DNS --> CF_WAF

                        CF_WAF --> CF_Access

                        CF_Access <-->|"Secure Tunnel / HTTP2"| Tunneld

                            Tunneld <-->|"localhost:8080"| Spring

                                Spring <-->|"Read/Write"| DB

                                    Spring <-->|"Job Polling SQL"| DB

                                        Spring -.->|"Async Retry"| Google

                                        Spring -.->|"Async Retry"| Slack

                                        Spring -.->|"Async Retry"| Freee

                                        style Tunneld fill:#ffe4e6,stroke:#e11d48,stroke-width:2px

                                        style Firewall fill:#f3f4f6,stroke:#9ca3af,stroke-dasharray: 5 5

                                        style CF_Access fill:#dbeafe,stroke:#1e40af,stroke-width:2px

                                        style DB fill:#fff7ed,stroke:#ea580c,stroke-width:2px

                                        style Docker fill:#e0f2fe,stroke:#0284c7,stroke-width:2px

                    </div>

                </div>



                <div class="note">

                    <strong>ğŸ”’ Cloudflare Tunnelã®åˆ©ç‚¹:</strong>

                    è‡ªç¤¾ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ã®<strong>ã‚¤ãƒ³ãƒã‚¦ãƒ³ãƒ‰ãƒãƒ¼ãƒˆ(80/443)ã‚’ä¸€åˆ‡é–‹æ”¾ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã›ã‚“</strong>ã€‚

                    ç¤¾å†…ã‚µãƒ¼ãƒä¸Šã®ã‚³ãƒã‚¯ã‚¿(cloudflared)ãŒCloudflareã¸ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰æ¥ç¶šã‚’ç¢ºç«‹ã™ã‚‹ãŸã‚ã€å¤–éƒ¨ã‹ã‚‰ã®æ”»æ’ƒå¯¾è±¡é ˜åŸŸ(Attack Surface)ã‚’æ¥µå°åŒ–ã§ãã¾ã™ã€‚

                </div>

                <div class="note">

                    <strong>ğŸ³ Docker Composeã®æ¡ç”¨:</strong>

                    Spring Boot ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨PostgreSQLã‚’Dockerã‚³ãƒ³ãƒ†ãƒŠã¨ã—ã¦ç®¡ç†ã—ã¾ã™ã€‚
                    <code>docker compose up -d</code> ã§ã‚µãƒ¼ãƒ“ã‚¹ä¸€å¼ã‚’èµ·å‹•ã§ãã€ç’°å¢ƒæ§‹ç¯‰ã®å†ç¾æ€§ã¨ãƒ‡ãƒ—ãƒ­ã‚¤ã®ç°¡ä¾¿æ€§ã‚’ç¢ºä¿ã—ã¾ã™ã€‚
                    cloudflaredã¯ãƒ›ã‚¹ãƒˆå´ã§å‹•ä½œã—ã€ã‚³ãƒ³ãƒ†ãƒŠå†…ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ (localhost:8080) ã¸ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è»¢é€ã—ã¾ã™ã€‚

                </div>



                <div class="card">

                    <h4>âš ï¸ Service Tokenã«ã‚ˆã‚‹èªè¨¼ (æ¡ç”¨)</h4>

                    <p>Cloudflare Accessã®ãƒ–ãƒ©ã‚¦ã‚¶èªè¨¼ç”»é¢ã‚’å›é¿ã™ã‚‹ãŸã‚ã€ç™ºè¡Œã—ãŸService Token (Client ID / Secret) ã‚’ã‚¢ãƒ—ãƒªå†…ã«åŸ‹ã‚è¾¼ã¿ã¾ã™ã€‚</p>

                    <p><strong>è¨±å®¹ãƒªã‚¹ã‚¯:</strong> ãƒˆãƒ¼ã‚¯ãƒ³æµå‡ºæ™‚ã‚„æœŸé™åˆ‡ã‚Œï¼ˆ1å¹´ï¼‰ã®éš›ã¯ã€ã‚¢ãƒ—ãƒªã®å¼·åˆ¶ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆãŒå¿…è¦ã¨ãªã‚Šã¾ã™ãŒã€50åè¦æ¨¡ã®ãŸã‚é‹ç”¨å¯¾å‡¦å¯èƒ½ã¨åˆ¤æ–­ã—ã¾ã™ã€‚</p>

                </div>

            </section>



            <section>

                <h2>ğŸ”§ æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯</h2>

                <div class="tech-stack">

                    <div class="tech-item">

                        <h4>ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰</h4>

                        <p>iOS: React Native<br>Android: Android Studio (Java)</p>

                    </div>

                    <div class="tech-item">

                        <h4>ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰</h4>

                        <p>Java 17+ / Spring Boot 3.x<br><strong>Docker Compose</strong><br>Job Queue (DB-backed / JobRunrç­‰)</p>

                    </div>

                    <div class="tech-item">

                        <h4>ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹</h4>

                        <p>PostgreSQL<br>(æ‰“åˆ»ãƒ»ãƒˆãƒ¼ã‚¯ãƒ³ãƒ»ã‚¸ãƒ§ãƒ–ç®¡ç†)</p>

                    </div>

                    <div class="tech-item">

                        <h4>èªè¨¼ãƒ»IDç®¡ç†</h4>

                        <p>Google OAuth 2.0<br>JWT / Service Token</p>

                    </div>

                    <div class="tech-item">

                        <h4>å¤–éƒ¨é€£æº</h4>

                        <p>Slack API (OAuth v2)<br>freee API</p>

                    </div>

                    <div class="tech-item">

                        <h4>ã‚¤ãƒ³ãƒ•ãƒ©</h4>

                        <p>Linux Server (On-Prem)<br>Docker Compose<br>Cloudflare Tunnel</p>

                    </div>

                </div>

            </section>



            <section>

                <h2>ğŸ” ãƒ­ã‚°ã‚¤ãƒ³ãƒ»å¤–éƒ¨APIèªè¨¼ãƒ•ãƒ­ãƒ¼</h2>

                <p>ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒGoogleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§è‡ªç¤¾ã‚¢ãƒ—ãƒªã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã€ãã®å¾ŒSlack/freeeã¨ã®é€£æºè¨±å¯ã‚’è¡Œã†ã¾ã§ã®æµã‚Œã§ã™ã€‚</p>



                <div class="diagram-container">

                    <div class="mermaid">

                        sequenceDiagram

                        autonumber

                        participant User as ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼

                        participant App as ğŸ“± ã‚¢ãƒ—ãƒª

                        participant Server as ğŸ–¥ï¸ è‡ªç¤¾ã‚µãƒ¼ãƒ

                        participant Google as ğŸŒ Google Auth

                        participant ExtAPI as â˜ï¸ Slack/freee

                        Note right of App: ã€Step 1ã€‘è‡ªç¤¾ãƒ­ã‚°ã‚¤ãƒ³ (Google SSO)

                        User->>App: ã€ŒGoogleã§ãƒ­ã‚°ã‚¤ãƒ³ã€ã‚¿ãƒƒãƒ—

                        App->>Google: èªè¨¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆ (Webview)

                        Google->>User: ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢è¡¨ç¤º

                        User->>Google: ID/Passå…¥åŠ›ãƒ»è¨±å¯

                        Google-->>App: Authorization Codeè¿”å´

                        App->>Server: Codeé€ä¿¡ (API: /api/auth/google)

                        Server->>Google: Codeæ¤œè¨¼ãƒ»Tokenå–å¾—

                        Google-->>Server: User Profile (Email, ID)

                        Server->>Server: ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²orç‰¹å®š (DB)

                        Server-->>App: è‡ªç¤¾JWTè¿”å´ (ãƒ­ã‚°ã‚¤ãƒ³å®Œäº†)

                        Note right of App: ã€Step 2ã€‘å¤–éƒ¨é€£æºè¨­å®š (åˆå›ã®ã¿)

                        User->>App: ã€ŒSlack/freeeã¨é€£æºã€ã‚¿ãƒƒãƒ—

                        App->>Server: é€£æºURLè¦æ±‚ (API: /api/slack/connect)

                        Server-->>App: Redirect URLè¿”å´

                        App->>ExtAPI: èªå¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆ (Webview)

                        ExtAPI->>User: è¨±å¯ç”»é¢è¡¨ç¤º

                        User->>ExtAPI: ã€Œè¨±å¯ã™ã‚‹ã€ã‚¿ãƒƒãƒ—

                        ExtAPI-->>Server: Callback (Codeä»˜ã)

                        Server->>ExtAPI: Access/Refresh Tokenå–å¾—

                        Server->>Server: ãƒˆãƒ¼ã‚¯ãƒ³æš—å·åŒ–ã—ã¦DBä¿å­˜

                        Server-->>App: é€£æºå®Œäº†é€šçŸ¥ (Push or Polling)

                    </div>

                </div>

            </section>



            <section>

                <h2>âš™ï¸ å¤–éƒ¨APIãƒˆãƒ¼ã‚¯ãƒ³è‡ªå‹•æ›´æ–°ãƒ•ãƒ­ãƒ¼ (Server-Side)</h2>

                <p>Slackã‚„freeeã®ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³æœŸé™åˆ‡ã‚Œæ™‚ã€ã‚µãƒ¼ãƒãƒ¼ãŒè‡ªå¾‹çš„ã«ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½¿ã£ã¦æ›´æ–°ã™ã‚‹ãƒ•ãƒ­ãƒ¼ã§ã™ã€‚<br>

                    <strong>â€»ã‚¹ãƒãƒ›ã‚¢ãƒ—ãƒªå´ã¯ã“ã®å‡¦ç†ã«é–¢ä¸ã›ãšã€ãƒˆãƒ¼ã‚¯ãƒ³æ›´æ–°ã‚’æ„è­˜ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</strong>

                </p>



                <div class="diagram-container">

                    <div class="mermaid">

                        sequenceDiagram

                        autonumber

                        participant App as ğŸ“± ã‚¢ãƒ—ãƒª

                        participant Server as ğŸ–¥ï¸ è‡ªç¤¾ã‚µãƒ¼ãƒ

                        participant DB as ğŸ—„ï¸ DB

                        participant ExtAPI as â˜ï¸ Slack/freee



                        Note right of App: ã‚¢ãƒ—ãƒªã¯å˜ã«æ‰“åˆ»APIã‚’å©ãã ã‘

                        App->>Server: æ‰“åˆ»ãƒªã‚¯ã‚¨ã‚¹ãƒˆ



                        rect rgb(240, 248, 255)

                        Note right of Server: ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰å‡¦ç†ä¸­

                        Server->>DB: ãƒˆãƒ¼ã‚¯ãƒ³å–å¾— (å¾©å·åŒ–)

                        Server->>ExtAPI: APIãƒªã‚¯ã‚¨ã‚¹ãƒˆ (Access Token)



                        alt ãƒˆãƒ¼ã‚¯ãƒ³æœ‰åŠ¹

                        ExtAPI-->>Server: 200 OK (æˆåŠŸ)

                        else ãƒˆãƒ¼ã‚¯ãƒ³æœŸé™åˆ‡ã‚Œ (401 Unauthorized)

                        ExtAPI-->>Server: 401 Error

                        Note right of Server: ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥å‡¦ç†é–‹å§‹

                        Server->>ExtAPI: æ›´æ–°ãƒªã‚¯ã‚¨ã‚¹ãƒˆ (Refresh Token)

                        ExtAPI-->>Server: æ–°Access/Refresh Tokenè¿”å´

                        Server->>DB: æ–°ãƒˆãƒ¼ã‚¯ãƒ³ä¿å­˜ (æš—å·åŒ–)

                        Server->>ExtAPI: APIãƒªã‚¯ã‚¨ã‚¹ãƒˆå†è©¦è¡Œ (Retry)

                        ExtAPI-->>Server: 200 OK (æˆåŠŸ)

                        end

                        end

                    </div>

                </div>



                <div class="note">

                    <strong>ğŸ“± ã‚¢ãƒ—ãƒªãƒãƒ¼ãƒ ã¸ã®ä¼é”äº‹é …:</strong><br>

                    å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆSlack/freeeï¼‰ã®èªè¨¼ã¯ã€Œåˆå›é€£æºæ™‚ã€ã®ã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œãŒå¿…è¦ã§ã™ã€‚<br>

                    ãã‚Œä»¥é™ã®ãƒˆãƒ¼ã‚¯ãƒ³ç¶­æŒãƒ»æ›´æ–°ã¯ã™ã¹ã¦ã‚µãƒ¼ãƒãƒ¼å´ã®ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰å‡¦ç†ã§è¡Œã‚ã‚Œã‚‹ãŸã‚ã€<strong>ã‚¢ãƒ—ãƒªå´ã§å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã®å†ãƒ­ã‚°ã‚¤ãƒ³ã‚„ãƒˆãƒ¼ã‚¯ãƒ³æ›´æ–°ã‚’å®Ÿè£…ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</strong>

                </div>

            </section>



            <section>

                <h2>ğŸ”„ JWTã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³å†å–å¾—ãƒ•ãƒ­ãƒ¼</h2>

                <p>ã‚¢ãƒ—ãƒªãŒä¿æŒã™ã‚‹JWTï¼ˆã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ï¼‰ã®æœ‰åŠ¹æœŸé™ãŒåˆ‡ã‚ŒãŸéš›ã€ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½¿ç”¨ã—ã¦æ–°ã—ã„JWTã‚’å–å¾—ã™ã‚‹ãƒ•ãƒ­ãƒ¼ã§ã™ã€‚</p>



                <div class="diagram-container">

                    <div class="mermaid">

                        sequenceDiagram

                        autonumber

                        participant App as ğŸ“± ã‚¢ãƒ—ãƒª

                        participant Server as ğŸ–¥ï¸ è‡ªç¤¾ã‚µãƒ¼ãƒ

                        participant DB as ğŸ—„ï¸ DB



                        Note right of App: APIãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚

                        App->>Server: 1. APIãƒªã‚¯ã‚¨ã‚¹ãƒˆ (JWTæœŸé™åˆ‡ã‚Œ)

                        Server-->>App: 401 Unauthorized



                        Note right of App: ãƒˆãƒ¼ã‚¯ãƒ³æ›´æ–°å‡¦ç† (Middleware)

                        App->>Server: 2. æ›´æ–°ãƒªã‚¯ã‚¨ã‚¹ãƒˆ (API: /api/auth/refresh)

                        Note right of Server: Body: { refreshToken: "..." }

                        Server->>DB: ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼

                        alt æœ‰åŠ¹

                        Server-->>App: 200 OK (æ–°ã—ã„JWTè¿”å´)

                        App->>App: æ–°JWTã‚’ä¿å­˜ & ãƒªã‚¯ã‚¨ã‚¹ãƒˆå†é€

                        else ç„¡åŠ¹/æœŸé™åˆ‡ã‚Œ

                        Server-->>App: 401 Unauthorized (å†ãƒ­ã‚°ã‚¤ãƒ³è¦æ±‚)

                        App->>App: ãƒ­ã‚°ã‚¢ã‚¦ãƒˆå‡¦ç† (ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã¸é·ç§»)

                        end

                    </div>

                </div>

            </section>



            <section>

                <h2>ğŸ”„ æ‰“åˆ»å‡¦ç†ãƒ•ãƒ­ãƒ¼ (éåŒæœŸãƒ»ä¿¡é ¼æ€§é‡è¦–)</h2>

                <p>å¤–éƒ¨APIé€£æºï¼ˆSlack/freeeï¼‰ã‚’éåŒæœŸåŒ–ã—ã€ä¸€æ™‚çš„ãªãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯éšœå®³ãŒã‚ã£ã¦ã‚‚è‡ªå‹•å›å¾©ã™ã‚‹ä»•çµ„ã¿ã§ã™ã€‚</p>



                <div class="diagram-container">

                    <div class="mermaid">

                        sequenceDiagram

                        autonumber

                        participant App as ğŸ“± ã‚¢ãƒ—ãƒª

                        participant Server as ğŸ–¥ï¸ è‡ªç¤¾ã‚µãƒ¼ãƒ

                        participant DB as ğŸ—„ï¸ DB (Table)

                        participant Ext as â˜ï¸ å¤–éƒ¨API

                        Note right of App: Service Tokenä»˜ä¸

                        App->>Server: æ‰“åˆ»ãƒªã‚¯ã‚¨ã‚¹ãƒˆ

                        rect rgb(240, 248, 255)

                        Note right of Server: æ‰‹å‹•æ™‚åˆ»æŒ‡å®šãŒã‚ã‚‹å ´åˆã¯æ¡ç”¨<br>ãªã„å ´åˆã¯Server Timeã‚’æ¡ç”¨

                        Server->>DB: 1. æ‰“åˆ»ãƒ‡ãƒ¼ã‚¿ä¿å­˜ (Status: Pending)

                        Server->>DB: 2. ã‚¸ãƒ§ãƒ–ãƒ†ãƒ¼ãƒ–ãƒ«ã¸ç™»éŒ² (Transactional)

                        end

                        Server-->>App: 202 Accepted (å—ä»˜å®Œäº†)

                        par ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰å‡¦ç† (Worker)

                        loop ãƒªãƒˆãƒ©ã‚¤å‡¦ç† (æœ€å¤§3å› / æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•)

                        Server->>DB: ã‚¸ãƒ§ãƒ–å–å¾— (Polling/Lock)

                        Server->>Server: Slackãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…å®¹ã®æ±ºå®š (ãƒ­ã‚¸ãƒƒã‚¯å‚ç…§)

                        Server->>Ext: APIã‚³ãƒ¼ãƒ« (freee/Slack)

                        alt æˆåŠŸ

                        Ext-->>Server: OK

                        Server->>DB: Jobå®Œäº† / Status: Success

                        else å¤±æ•—/Timeout

                        Server->>DB: ãƒªãƒˆãƒ©ã‚¤æ—¥æ™‚è¨­å®š

                        Note right of DB: æœ€çµ‚å¤±æ•—æ™‚ã¯ç®¡ç†è€…é€šçŸ¥ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã¸

                        end

                        end

                        end

                    </div>

                </div>

            </section>



            <section>

                <h2>â˜ï¸ å¤–éƒ¨APIé€£æºè©³ç´°ä»•æ§˜ (Server-Side)</h2>

                <p>è‡ªç¤¾ã‚µãƒ¼ãƒãƒ¼ï¼ˆSpring Bootï¼‰ã‹ã‚‰å®Ÿè¡Œã™ã‚‹å¤–éƒ¨APIãƒªã‚¯ã‚¨ã‚¹ãƒˆã®è©³ç´°ã§ã™ã€‚</p>



                <div class="card">

                    <h4>ğŸ’¬ 1. Slack API é€£æºãƒ•ãƒ­ãƒ¼</h4>

                    <p><strong>Endpoint:</strong> <code>https://slack.com/api/chat.postMessage</code> (POST)</p>

                    <div class="diagram-container">

                        <div class="mermaid">

                            graph TD

                            Start["å‡¦ç†é–‹å§‹"] --> FetchToken["DBã‹ã‚‰Slackãƒˆãƒ¼ã‚¯ãƒ³å–å¾—"]

                            FetchToken --> Decrypt["ãƒˆãƒ¼ã‚¯ãƒ³å¾©å·åŒ–"]

                            Decrypt --> PostAPI["APIé€ä¿¡<br>chat.postMessage"]

                            PostAPI --> CheckResult{"çµæœç¢ºèª"}

                            CheckResult -- "ok: true" --> End["æˆåŠŸçµ‚äº†"]

                            CheckResult -- "error: token_expired" --> Refresh["ãƒˆãƒ¼ã‚¯ãƒ³æ›´æ–°å‡¦ç†"]

                            Refresh --> Retry["APIå†é€ä¿¡"]

                            Retry --> CheckResult

                            CheckResult -- "ãã®ä»–ã‚¨ãƒ©ãƒ¼" --> Error["ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°è¨˜éŒ²<br>ãƒªãƒˆãƒ©ã‚¤ã‚­ãƒ¥ãƒ¼ã¸"]

                        </div>

                    </div>

                    <div class="table-responsive">

                        <table>

                            <thead>

                                <tr>

                                    <th>Body Parameter</th>

                                    <th>å€¤ã®ç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯</th>

                                </tr>

                            </thead>

                            <tbody>

                                <tr>

                                    <td><code>channel</code></td>

                                    <td><code>#timesheets</code> (ã¾ãŸã¯å¯¾å¿œã™ã‚‹Channel ID)</td>

                                </tr>

                                <tr>

                                    <td><code>text</code></td>

                                    <td>

                                        ã‚µãƒ¼ãƒãƒ¼å´ã§ç”Ÿæˆã—ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸<br>

                                        ä¾‹: <code>"ãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™ 10:00"</code>

                                    </td>

                                </tr>

                                <tr>

                                    <td><code>as_user</code></td>

                                    <td><code>true</code> (é‡è¦: ãƒ¦ãƒ¼ã‚¶ãƒ¼æœ¬äººã¨ã—ã¦æŠ•ç¨¿)</td>

                                </tr>

                            </tbody>

                        </table>

                    </div>

                </div>



                <div class="card">

                    <h4>ğŸ“Š 2. freee API é€£æºãƒ•ãƒ­ãƒ¼</h4>

                    <p><strong>Endpoint (æ‰“åˆ»):</strong> <code>POST /hr/api/v1/employees/{emp_id}/time_clocks</code></p>
                    <p><strong>Endpoint (ä¼‘æš‡):</strong> <code>PUT /hr/api/v1/employees/{emp_id}/work_records/{date}</code> <span class="badge new">New</span></p>

                    <div class="diagram-container">

                        <div class="mermaid">

                            graph TD

                            Start["å‡¦ç†é–‹å§‹"] --> FetchToken["DBã‹ã‚‰freeeãƒˆãƒ¼ã‚¯ãƒ³å–å¾—"]

                            FetchToken --> Decrypt["ãƒˆãƒ¼ã‚¯ãƒ³å¾©å·åŒ–"]

                            Decrypt --> CheckCache{"å¾“æ¥­å“¡ID<br>ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚ã‚Š?"}

                            CheckCache -- "No" --> GetEmp["å¾“æ¥­å“¡å–å¾—API<br>/api/v1/users/me"]

                            GetEmp --> SaveCache["å¾“æ¥­å“¡IDä¿å­˜"]

                            CheckCache -- "Yes" --> CheckType{"æ‰“åˆ»ç¨®åˆ¥?"}

                            SaveCache --> CheckType

                            CheckType -- "å‡ºå‹¤ / é€€å‹¤" --> PostClock["æ‰“åˆ»APIé€ä¿¡<br>POST /time_clocks"]

                            CheckType -- "ä¼‘ã¿" --> PutRecord["å‹¤æ€ æ›´æ–°APIé€ä¿¡<br>PUT /work_records/date"]

                            PostClock --> CheckResult{"HTTP Status"}

                            PutRecord --> CheckResult

                            CheckResult -- "200-201" --> End["æˆåŠŸçµ‚äº†"]

                            CheckResult -- "401 Unauthorized" --> Refresh["ãƒˆãƒ¼ã‚¯ãƒ³æ›´æ–°å‡¦ç†"]

                            Refresh --> Retry["APIå†é€ä¿¡"]

                            Retry --> CheckResult

                            CheckResult -- "ãã®ä»–" --> Error["ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°è¨˜éŒ²<br>ãƒªãƒˆãƒ©ã‚¤ã‚­ãƒ¥ãƒ¼ã¸"]

                        </div>

                    </div>

                    <div class="table-responsive">

                        <table>

                            <thead>

                                <tr>

                                    <th>API</th>

                                    <th>Body Parameter</th>

                                    <th>å€¤ã®ç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯</th>

                                </tr>

                            </thead>

                            <tbody>

                                <tr>

                                    <td rowspan="3"><strong>æ‰“åˆ»<br>(time_clocks)</strong></td>

                                    <td><code>company_id</code></td>

                                    <td>è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«/ç’°å¢ƒå¤‰æ•°ã‹ã‚‰å–å¾—ã—ãŸäº‹æ¥­æ‰€ID</td>

                                </tr>

                                <tr>

                                    <td><code>type</code></td>

                                    <td>

                                        å‡ºå‹¤æ™‚: <code>clock_in</code><br>

                                        é€€å‹¤æ™‚: <code>clock_out</code>

                                    </td>

                                </tr>

                                <tr>

                                    <td><code>datetime</code></td>

                                    <td>

                                        æ‰“åˆ»æ™‚åˆ» (yyyy-MM-dd HH:mm:ss)<br>

                                        â€»æ‰‹å‹•æŒ‡å®šãŒã‚ã‚‹å ´åˆã¯ãã®æ™‚åˆ»ã€ãªã‘ã‚Œã°ã‚µãƒ¼ãƒãƒ¼ç¾åœ¨æ™‚åˆ»

                                    </td>

                                </tr>

                                <tr style="border-top: 3px solid #e5e7eb;">

                                    <td rowspan="4"><strong>ä¼‘æš‡<br>(work_records)</strong><br><span class="badge new">New</span></td>

                                    <td><code>company_id</code></td>

                                    <td>äº‹æ¥­æ‰€ID</td>

                                </tr>

                                <tr>

                                    <td><code>is_absence</code></td>

                                    <td>

                                        æ¬ å‹¤ã®å ´åˆ: <code>true</code><br>

                                        æœ‰çµ¦ã®å ´åˆ: <code>false</code>

                                    </td>

                                </tr>

                                <tr>

                                    <td><code>paid_holiday</code></td>

                                    <td>

                                        æœ‰çµ¦å…¨ä¼‘: <code>1</code><br>

                                        æœ‰çµ¦ã§ãªã„å ´åˆ: <code>0</code>

                                    </td>

                                </tr>

                            </tbody>

                        </table>

                    </div>

                    <div class="note">
                        <strong>ğŸ“ freee ä¼‘æš‡ç™»éŒ²ã®æ³¨æ„ç‚¹:</strong><br>
                        ä¼‘æš‡ã®ç™»éŒ²ã¯æ‰“åˆ»API (<code>time_clocks</code>) ã§ã¯ãªãã€å‹¤æ€ æ›´æ–°API (<code>work_records</code>) ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚ãƒ—ãƒ©ãƒ³ã«ã‚ˆã‚ŠAPIåˆ©ç”¨å¯å¦ãŒç•°ãªã‚‹ãŸã‚ã€äº‹å‰ã«ã”ç¢ºèªãã ã•ã„ã€‚
                    </div>

                </div>

            </section>



            <section>

                <h2>ğŸ’¬ Slacké€šçŸ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä»•æ§˜ (ã‚µãƒ¼ãƒãƒ¼å´ãƒ­ã‚¸ãƒƒã‚¯)</h2>

                <p>ã‚¢ãƒ—ãƒªã‹ã‚‰ã¯å˜ç´”ãªã€Œæ‰“åˆ»ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ã¿ã‚’é€ä¿¡ã—ã€Slackã¸æŠ•ç¨¿ã™ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…å®¹ã¯ã€ã‚µãƒ¼ãƒãƒ¼å´ã®ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã§æ±ºå®šã—ã¾ã™ã€‚</p>



                <div class="card">

                    <h4>ğŸ“® é€ä¿¡å…ˆãƒãƒ£ãƒ³ãƒãƒ«</h4>

                    <p><strong>#timesheets</strong> (å›ºå®š)</p>

                </div>



                <div class="table-responsive">

                    <h4>ğŸ“ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”Ÿæˆãƒ«ãƒ¼ãƒ«</h4>

                    <table>

                        <thead>

                            <tr>

                                <th>æ‰“åˆ»ç¨®åˆ¥</th>

                                <th>æ™‚åˆ»æŒ‡å®š</th>

                                <th>ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ</th>

                                <th>é€ä¿¡ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä¾‹</th>

                            </tr>

                        </thead>

                        <tbody>

                            <tr>

                                <td><strong>å‡ºå‹¤</strong></td>

                                <td>é€šå¸¸ (ç¾åœ¨æ™‚åˆ»)</td>

                                <td>å®šå‹æ–‡</td>

                                <td><code>ãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™</code></td>

                            </tr>

                            <tr>

                                <td><strong>å‡ºå‹¤</strong></td>

                                <td>æ‰‹å‹•å¤‰æ›´ã‚ã‚Š</td>

                                <td>å®šå‹æ–‡ + [HH:mm]</td>

                                <td><code>ãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™ 10:00</code></td>

                            </tr>

                            <tr>

                                <td><strong>é€€å‹¤</strong></td>

                                <td>é€šå¸¸ (ç¾åœ¨æ™‚åˆ»)</td>

                                <td>å®šå‹æ–‡</td>

                                <td><code>ãŠç–²ã‚Œæ§˜ã§ã™</code></td>

                            </tr>

                            <tr>

                                <td><strong>é€€å‹¤</strong></td>

                                <td>æ‰‹å‹•å¤‰æ›´ã‚ã‚Š</td>

                                <td>å®šå‹æ–‡ + [HH:mm]</td>

                                <td><code>ãŠç–²ã‚Œæ§˜ã§ã™ 19:00</code></td>

                            </tr>

                            <tr style="border-top: 3px solid #e5e7eb;">

                                <td><strong>ä¼‘ã¿</strong> <span class="badge new">New</span></td>

                                <td>-</td>

                                <td>å®šå‹æ–‡</td>

                                <td><code>æœ¬æ—¥ã¯ãŠä¼‘ã¿ã§ã™</code></td>

                            </tr>

                        </tbody>

                    </table>

                </div>



                <div class="card">

                    <h4>ğŸ”§ å®Ÿè£…ã‚¤ãƒ¡ãƒ¼ã‚¸ (Java Pseudo Code)</h4>

                    <div class="code-block">public String generateSlackMessage(AttendanceLog log) {
                        StringBuilder sb = new StringBuilder();

                        // 1. ä¼‘ã¿å ±å‘Š
                        if (log.getActionType() == ActionType.DAY_OFF) {
                        return "æœ¬æ—¥ã¯ãŠä¼‘ã¿ã§ã™";
                        }

                        // 2. åŸºæœ¬æŒ¨æ‹¶
                        if (log.getActionType() == ActionType.CLOCK_IN) {
                        sb.append("ãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™");
                        } else {
                        sb.append("ãŠç–²ã‚Œæ§˜ã§ã™");
                        }

                        // 3. æ‰‹å‹•ä¿®æ­£æ™‚ã®æ™‚åˆ»ä»˜ä¸
                        if (log.isManual()) {
                        String timeStr = log.getStampedAt().format(DateTimeFormatter.ofPattern("HH:mm"));
                        sb.append(" ").append(timeStr);
                        }

                        return sb.toString();
                        }</div>

                </div>

            </section>



            <section>

                <h2>ğŸ”‘ ãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç†ãƒ»æ’ä»–åˆ¶å¾¡</h2>



                <div class="card">

                    <h4>ğŸ”„ ãƒˆãƒ¼ã‚¯ãƒ³æ›´æ–°ã®æ’ä»–åˆ¶å¾¡ (Race Conditionå¯¾ç­–)</h4>

                    <p>ã‚¢ãƒ—ãƒªã‹ã‚‰ã®ä¸¦åˆ—ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«ã‚ˆã‚Šã€ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ãŒåŒæ™‚ã«ä½¿ç”¨ã•ã‚Œã¦ç„¡åŠ¹åŒ–ã•ã‚Œã‚‹ã®ã‚’é˜²ããŸã‚ã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å´ã§ãƒ­ãƒƒã‚¯åˆ¶å¾¡ã‚’å®Ÿè£…ã—ã¾ã™ã€‚</p>

                    <div class="code-block">// Java (Spring Boot) Pseudo Code
                        public synchronized Token refreshAccessToken(String userId) {
                        // 1. DBã‹ã‚‰æœ€æ–°ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å†å–å¾— (Double Check)
                        Token current = db.findToken(userId);

                        // 2. æœ‰åŠ¹æœŸé™ã‚’ãƒã‚§ãƒƒã‚¯ (åˆ¥ã‚¹ãƒ¬ãƒƒãƒ‰ãŒæ—¢ã«æ›´æ–°æ¸ˆã¿ãªã‚‰ä½•ã‚‚ã—ãªã„)
                        if (current.isValid()) {
                        return current;
                        }

                        // 3. å®Ÿéš›ã«Refresh APIã‚’å©ã
                        return executeRefreshLogic(current);
                        }</div>

                </div>



                <div class="table-responsive">

                    <table>

                        <thead>

                            <tr>

                                <th>ãƒˆãƒ¼ã‚¯ãƒ³ç¨®åˆ¥</th>

                                <th>ä¿å­˜å ´æ‰€</th>

                                <th>æš—å·åŒ–</th>

                                <th>æœ‰åŠ¹æœŸé™</th>

                                <th>æ›´æ–°ãƒ­ã‚¸ãƒƒã‚¯</th>

                            </tr>

                        </thead>

                        <tbody>

                            <tr>

                                <td><strong>CF Service Token</strong></td>

                                <td>ã‚¢ãƒ—ãƒªå†…</td>

                                <td>-</td>

                                <td>1å¹´</td>

                                <td>ã‚¢ãƒ—ãƒªæ›´æ–°æ™‚ã«æ‰‹å‹•å·®æ›¿ãˆ</td>

                            </tr>

                            <tr>

                                <td><strong>JWT (è‡ªç¤¾)</strong></td>

                                <td>ã‚¢ãƒ—ãƒª(Secure)</td>

                                <td>ç½²å</td>

                                <td>24æ™‚é–“</td>

                                <td>ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ã§æ›´æ–°</td>

                            </tr>

                            <tr>

                                <td><strong>External Access Token</strong></td>

                                <td>DB (åˆ¥ãƒ†ãƒ¼ãƒ–ãƒ«)</td>

                                <td>AES-256</td>

                                <td>æ•°æ™‚é–“</td>

                                <td>æœŸé™åˆ‡ã‚Œæ™‚ã«<strong>ãƒ­ãƒƒã‚¯ä»˜ãè‡ªå‹•æ›´æ–°</strong></td>

                            </tr>

                            <tr>

                                <td><strong>External Refresh Token</strong></td>

                                <td>DB (åˆ¥ãƒ†ãƒ¼ãƒ–ãƒ«)</td>

                                <td>AES-256</td>

                                <td>æ°¸ç¶š/æœ‰é™</td>

                                <td>ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³æ›´æ–°æ™‚ã«æ›´æ–°(Rotation)</td>

                            </tr>

                        </tbody>

                    </table>

                </div>

            </section>



            <section>

                <h2>ğŸ›¡ï¸ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é…æ…®æ–¹é‡</h2>



                <div class="security-list">

                    <h3>âœ… é‡ç‚¹å¯¾ç­–é …ç›®</h3>

                    <ul>

                        <li><strong>æ™‚åˆ»ã®çœŸæ­£æ€§æ‹…ä¿:</strong> ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ™‚åˆ»ã‚’æ‰‹å‹•å¤‰æ›´ã—ãŸå ´åˆã¯ã€DBã«ã€Œæ‰‹å‹•ãƒ•ãƒ©ã‚°ã€ã¨ã€Œç›£æŸ»ç”¨ã‚·ã‚¹ãƒ†ãƒ æ™‚åˆ»(created_at)ã€ã‚’è¨˜éŒ²ã—ã€ä¸æ­£æ”¹ã–ã‚“ã¨æ­£è¦ä¿®æ­£ã‚’åŒºåˆ¥ã—ã¾ã™ã€‚</li>

                        <li><strong>äºŒé‡æ‰“åˆ»é˜²æ­¢:</strong> å†ªç­‰æ€§ã‚­ãƒ¼ï¼ˆRequest IDï¼‰ã¨ã€ç›´è¿‘1åˆ†ä»¥å†…ã®åŒä¸€ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ç¦æ­¢ãƒ­ã‚¸ãƒƒã‚¯ã§é‡è¤‡ã‚’æ’é™¤ã—ã¾ã™ã€‚</li>

                        <li><strong>Cloudflare Tunnel:</strong> ãƒãƒ¼ãƒˆé–‹æ”¾ä¸è¦ã®ã‚¼ãƒ­ãƒˆãƒ©ã‚¹ãƒˆæ¥ç¶šã«ã‚ˆã‚Šã€ã‚¤ãƒ³ãƒã‚¦ãƒ³ãƒ‰æ”»æ’ƒã‚’ç„¡åŠ¹åŒ–ã—ã¾ã™ã€‚</li>

                        <li><strong>Service Tokenèªè¨¼:</strong> Cloudflare Accessãƒãƒªã‚·ãƒ¼ã§è¨±å¯ã•ã‚ŒãŸãƒˆãƒ¼ã‚¯ãƒ³ã‚’æŒã¤ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ã¿ã‚’é€šã—ã¾ã™ã€‚</li>

                        <li><strong>DBæš—å·åŒ–:</strong> å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã®é€£æºãƒˆãƒ¼ã‚¯ãƒ³ã¯ã™ã¹ã¦AES-256ã§æš—å·åŒ–ã—ã¦ä¿å­˜ã—ã¾ã™ã€‚</li>

                    </ul>

                </div>

            </section>



            <section>

                <h2>ğŸ“¡ REST APIè¨­è¨ˆè©³ç´°</h2>

                <p>éåŒæœŸå‡¦ç†åŒ–ã«ä¼´ã„ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’202ã«å¤‰æ›´ã€‚<strong>æ‰‹å‹•æ™‚åˆ»æŒ‡å®šï¼ˆæ‰“åˆ»å¿˜ã‚Œå¯¾å¿œï¼‰</strong>ç”¨ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚</p>



                <h3>ğŸ“ å‡ºå‹¤æ‰“åˆ» (Clock-In)</h3>

                <p><strong>Endpoint:</strong> <code>POST /api/attendance/clock-in</code></p>

                <div class="code-block">// Headers
                    Authorization: Bearer &lt;JWT_TOKEN&gt;
                    X-Request-ID: "uuid-v4" // å†ªç­‰æ€§æ‹…ä¿ç”¨
                    CF-Access-Client-Id: "..." // Service Token
                    CF-Access-Client-Secret: "..." // Service Token

                    // Body
                    {
                    // ä»»æ„: æ‰“åˆ»å¿˜ã‚Œæ™‚ãªã©ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæŒ‡å®šã—ãŸæ™‚åˆ»ã€‚
                    // nullã®å ´åˆã¯ã‚µãƒ¼ãƒãƒ¼ã®ç¾åœ¨æ™‚åˆ»(LocalDateTime.now())ã‚’ä½¿ç”¨ã™ã‚‹ã€‚
                    "manual_timestamp": "2026-02-10T09:00:00Z",

                    "note": "é›»è»Šé…å»¶ã®ãŸã‚é…åˆ»ï¼ˆæ‰‹å‹•ä¿®æ­£ï¼‰" // ä»»æ„
                    }

                    // Response (202 Accepted) - å³æ™‚è¿”å´
                    {
                    "status": "accepted",
                    "message": "æ‰“åˆ»ã‚’å—ã‘ä»˜ã‘ã¾ã—ãŸ",
                    "data": {
                    "effective_time": "2026-02-10T09:00:00Z", // freeeç­‰ã«ç™»éŒ²ã•ã‚Œã‚‹æ™‚åˆ»
                    "is_manual": true,
                    "log_id": 12345
                    }
                    }</div>

                <h3>ğŸ–ï¸ ä¼‘ã¿å ±å‘Š (Day-Off) <span class="badge new">New</span></h3>

                <p><strong>Endpoint:</strong> <code>POST /api/attendance/day-off</code></p>

                <div class="code-block">// Headers (å‡ºå‹¤æ‰“åˆ»ã¨åŒä¸€)
                    Authorization: Bearer &lt;JWT_TOKEN&gt;
                    X-Request-ID: "uuid-v4"
                    CF-Access-Client-Id: "..."

                    // Body
                    {
                    "date": "2026-02-10",
                    "leave_type": "paid_holiday", // "paid_holiday" | "absence"
                    "note": "é€šé™¢ã®ãŸã‚" // ä»»æ„
                    }

                    // Response (202 Accepted)
                    {
                    "status": "accepted",
                    "message": "ä¼‘ã¿å ±å‘Šã‚’å—ã‘ä»˜ã‘ã¾ã—ãŸ",
                    "data": {
                    "date": "2026-02-10",
                    "leave_type": "paid_holiday",
                    "leave_type_label": "æœ‰çµ¦ä¼‘æš‡",
                    "log_id": 12346
                    }
                    }</div>

                <div class="table-responsive">
                    <table>
                        <thead>
                            <tr>
                                <th><code>leave_type</code> å€¤</th>
                                <th>è¡¨ç¤ºå</th>
                                <th>freeeé€£æºå…ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿</th>
                                <th>Slackãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>paid_holiday</code></td>
                                <td>æœ‰çµ¦ä¼‘æš‡</td>
                                <td><code>paid_holiday: 1</code></td>
                                <td>æœ¬æ—¥ã¯ãŠä¼‘ã¿ã§ã™</td>
                            </tr>
                            <tr>
                                <td><code>absence</code></td>
                                <td>æ¬ å‹¤</td>
                                <td><code>is_absence: true</code></td>
                                <td>æœ¬æ—¥ã¯ãŠä¼‘ã¿ã§ã™</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

            </section>



            <section>

                <h2>ğŸ“± ã‚¹ãƒãƒ›ã‚¢ãƒ—ãƒªç”»é¢ä»•æ§˜ & UIã‚¤ãƒ¡ãƒ¼ã‚¸</h2>

                <p>ã‚·ãƒ³ãƒ—ãƒ«ãªæ“ä½œæ€§ã‚’ç¶­æŒã—ã¤ã¤ã€æ‰‹å‹•æ™‚åˆ»æŒ‡å®šãªã©ã®ä¾‹å¤–å¯¾å¿œã‚‚è€ƒæ…®ã—ãŸUIè¨­è¨ˆã§ã™ã€‚</p>



                <h3>1. ç”»é¢é·ç§»å›³</h3>

                <div class="diagram-container">

                    <div class="mermaid">

                        graph LR

                        Splash["èµ·å‹•ç”»é¢"] --> CheckAuth{"ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹"}

                        CheckAuth -- "æœªãƒ­ã‚°ã‚¤ãƒ³" --> Login["ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢"]

                        CheckAuth -- "ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆ" --> Main["ãƒ¡ã‚¤ãƒ³ç”»é¢"]

                        Login --> |"Googleèªè¨¼"| Main

                        Main --> |"å‡ºå‹¤/é€€å‹¤ãƒœã‚¿ãƒ³"| Loading["å‡¦ç†ä¸­"]

                        Loading --> Success["å®Œäº†ãƒ€ã‚¤ã‚¢ãƒ­ã‚°"]

                        Main --> |"æ—¥æ™‚ã‚’å¤‰æ›´ã—ã¦æ‰“åˆ»"| ManualModal["æ‰‹å‹•æ‰“åˆ»ãƒ¢ãƒ¼ãƒ€ãƒ«"]

                        ManualModal --> |"ç¢ºå®š"| Loading

                        Main --> |"ä¼‘ã¿å ±å‘Š"| DayOffModal["ä¼‘ã¿å ±å‘Šãƒ¢ãƒ¼ãƒ€ãƒ«"]

                        DayOffModal --> |"ç¢ºå®š"| Loading

                        Main --> |"è¨­å®šã‚¢ã‚¤ã‚³ãƒ³"| Settings["é€£æºè¨­å®šç”»é¢"]

                    </div>

                </div>



                <h3>2. ä¸»è¦ç”»é¢ãƒ¢ãƒƒã‚¯ã‚¢ãƒƒãƒ—</h3>

                <div class="mockup-container">

                    <div class="smartphone">

                        <div class="smartphone-header">ãƒ­ã‚°ã‚¤ãƒ³</div>

                        <div class="smartphone-body">

                            <h2 style="color: #333; margin-bottom: 30px;">å‹¤æ€ ã‚¢ãƒ—ãƒª</h2>

                            <button class="ui-login-btn">

                                <span style="font-size: 1.2em;">G</span> Googleã§ãƒ­ã‚°ã‚¤ãƒ³

                            </button>

                        </div>

                    </div>



                    <div class="smartphone">

                        <div class="smartphone-header">ãƒ¡ã‚¤ãƒ³</div>

                        <div class="smartphone-body">

                            <div style="position: absolute; top: 10px; right: 10px;">âš™ï¸</div>

                            <div style="text-align: center;">

                                <p style="margin:0; color:#666;">2026/02/10 (ç«)</p>

                                <div class="ui-time">08:55</div>

                            </div>



                            <button class="ui-btn in">

                                <span>å‡ºå‹¤</span>

                                <small style="font-size:0.5em; font-weight:normal;">Clock In</small>

                            </button>



                            <div class="ui-link">æ—¥æ™‚ã‚’æŒ‡å®šã—ã¦æ‰“åˆ»</div>

                            <div class="ui-link" style="margin-top: 8px; color: #6d28d9;">ğŸ–ï¸ ä¼‘ã¿å ±å‘Š</div>

                        </div>

                    </div>



                    <div class="smartphone">

                        <div class="smartphone-header">ä¼‘ã¿å ±å‘Šãƒ¢ãƒ¼ãƒ€ãƒ« <span class="badge new">New</span></div>

                        <div class="smartphone-body" style="background: rgba(0,0,0,0.5);">

                            <div class="ui-modal" style="height: 55%;">

                                <h4 style="margin-bottom: 15px; color:#6d28d9;">ğŸ–ï¸ ä¼‘ã¿å ±å‘Š</h4>

                                <div class="ui-input-group">
                                    <label class="ui-label">æ—¥ä»˜</label>
                                    <input type="date" class="ui-input" value="2026-02-10">
                                </div>

                                <div class="ui-input-group">
                                    <label class="ui-label">ä¼‘æš‡ç¨®åˆ¥</label>
                                    <select class="ui-input">
                                        <option selected>æœ‰çµ¦ä¼‘æš‡</option>
                                        <option>æ¬ å‹¤</option>
                                    </select>
                                </div>

                                <div class="ui-input-group">
                                    <label class="ui-label">ãƒ¡ãƒ¢ (ä»»æ„)</label>
                                    <input type="text" class="ui-input" placeholder="ä¾‹: é€šé™¢ã®ãŸã‚">
                                </div>

                                <button class="ui-btn-submit" style="background: #6d28d9;">ä¼‘ã¿ã‚’å ±å‘Šã™ã‚‹</button>

                            </div>

                        </div>

                    </div>



                    <div class="smartphone">

                        <div class="smartphone-header">ãƒ¡ã‚¤ãƒ³ (ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º)</div>

                        <div class="smartphone-body" style="background: rgba(0,0,0,0.5);">

                            <div class="ui-modal">

                                <h4 style="margin-bottom: 15px; color:#1e40af;">æ—¥æ™‚æŒ‡å®šå‡ºå‹¤</h4>



                                <div class="ui-input-group">

                                    <label class="ui-label">æ—¥ä»˜</label>

                                    <input type="date" class="ui-input" value="2026-02-10">

                                </div>

                                <div class="ui-input-group">

                                    <label class="ui-label">æ™‚åˆ»</label>

                                    <input type="time" class="ui-input" value="09:00">

                                </div>

                                <div class="ui-input-group">

                                    <label class="ui-label">ãƒ¡ãƒ¢ (ä»»æ„)</label>

                                    <input type="text" class="ui-input" placeholder="ä¾‹: é›»è»Šé…å»¶">

                                </div>



                                <button class="ui-btn-submit">ã“ã®æ—¥æ™‚ã§æ‰“åˆ»</button>

                            </div>

                        </div>

                    </div>

                </div>

                <h3>3. å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹é€£æº (Slack / freee)</h3>

                <div class="note">
                    <strong>ğŸ“± åˆå›é€£æºã«ã¤ã„ã¦:</strong><br>
                    å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆSlack / freeeï¼‰ã®èªè¨¼ã¯<strong>ã€Œåˆå›é€£æºæ™‚ã€ã®ã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œãŒå¿…è¦</strong>ã§ã™ã€‚
                    è¨­å®šç”»é¢ã‹ã‚‰å„ã‚µãƒ¼ãƒ“ã‚¹ã®ã€Œé€£æºã™ã‚‹ã€ãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ—ã™ã‚‹ã¨ã€OAuthèªå¯ç”»é¢ï¼ˆWebviewï¼‰ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
                    ä¸€åº¦é€£æºãŒå®Œäº†ã™ã‚Œã°ã€ä»¥é™ã®ãƒˆãƒ¼ã‚¯ãƒ³ç¶­æŒãƒ»æ›´æ–°ã¯ã™ã¹ã¦ã‚µãƒ¼ãƒãƒ¼å´ã§è‡ªå‹•çš„ã«è¡Œã‚ã‚Œã‚‹ãŸã‚ã€<strong>å†ãƒ­ã‚°ã‚¤ãƒ³ã‚„å†é€£æºã®æ“ä½œã¯ä¸è¦</strong>ã§ã™ã€‚
                </div>

                <div class="mockup-container">

                    <div class="smartphone">

                        <div class="smartphone-header">é€£æºè¨­å®š</div>

                        <div class="smartphone-body" style="justify-content: flex-start; padding-top: 25px;">

                            <h4 style="color: #333; margin-bottom: 20px; align-self: flex-start;">ğŸ”— å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹é€£æº</h4>

                            <div style="width: 100%; margin-bottom: 15px; background: #fff; border: 1px solid #ddd; border-radius: 8px; padding: 12px; display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div style="font-weight: bold; font-size: 0.95em;">ğŸ’¬ Slack</div>
                                    <div style="font-size: 0.75em; color: #16a34a;">âœ… é€£æºæ¸ˆã¿</div>
                                </div>
                                <button style="background: #e5e7eb; color: #666; border: none; padding: 6px 12px; border-radius: 4px; font-size: 0.8em;">è§£é™¤</button>
                            </div>

                            <div style="width: 100%; margin-bottom: 15px; background: #fff; border: 1px solid #ddd; border-radius: 8px; padding: 12px; display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div style="font-weight: bold; font-size: 0.95em;">ğŸ“Š freee</div>
                                    <div style="font-size: 0.75em; color: #9ca3af;">æœªé€£æº</div>
                                </div>
                                <button style="background: #1e40af; color: #fff; border: none; padding: 6px 12px; border-radius: 4px; font-size: 0.8em;">é€£æºã™ã‚‹</button>
                            </div>

                            <p style="font-size: 0.7em; color: #9ca3af; margin-top: 10px; line-height: 1.5; align-self: flex-start;">
                                â€» é€£æºã¯åˆå›ã®ã¿å¿…è¦ã§ã™ã€‚<br>ä»¥é™ã®èªè¨¼æ›´æ–°ã¯ã‚µãƒ¼ãƒãƒ¼ãŒè‡ªå‹•ã§è¡Œã„ã¾ã™ã€‚
                            </p>

                        </div>

                    </div>

                    <div class="smartphone">

                        <div class="smartphone-header">freee é€£æºèªå¯</div>

                        <div class="smartphone-body" style="justify-content: flex-start; padding-top: 25px;">

                            <div style="width: 100%; text-align: center; padding: 20px 10px;">
                                <div style="font-size: 2em; margin-bottom: 10px;">ğŸ“Š</div>
                                <h4 style="color: #333; margin-bottom: 15px;">freee äººäº‹åŠ´å‹™</h4>
                                <p style="font-size: 0.8em; color: #666; margin-bottom: 20px; line-height: 1.5;">
                                    ã€Œå‹¤æ€ ã‚¢ãƒ—ãƒªã€ãŒä»¥ä¸‹ã®æ¨©é™ã‚’<br>è¦æ±‚ã—ã¦ã„ã¾ã™ï¼š
                                </p>
                                <div style="text-align: left; background: #f9fafb; border-radius: 6px; padding: 10px; margin-bottom: 20px; font-size: 0.78em; color: #555;">
                                    âœ… å‹¤æ€ ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿æ›¸ã<br>
                                    âœ… å¾“æ¥­å“¡æƒ…å ±ã®èª­ã¿å–ã‚Š
                                </div>
                                <button style="background: #16a34a; color: #fff; border: none; padding: 10px 40px; border-radius: 6px; font-weight: bold; font-size: 0.95em; width: 100%;">è¨±å¯ã™ã‚‹</button>
                                <button style="background: #fff; color: #666; border: 1px solid #ddd; padding: 8px 40px; border-radius: 6px; font-size: 0.85em; margin-top: 8px; width: 100%;">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                            </div>

                        </div>

                    </div>

                </div>

            </section>



            <section>

                <h2>ğŸ“± ã‚¹ãƒãƒ›ã‚¢ãƒ—ãƒªãƒãƒ¼ãƒ å®Ÿè£…è¦ä»¶ã¾ã¨ã‚</h2>

                <p>Spring Bootãƒãƒ¼ãƒ ï¼ˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼‰ã¨é€£æºã™ã‚‹ãŸã‚ã«ã€ã‚¢ãƒ—ãƒªé–‹ç™ºè€…ãŒå®Ÿè£…ã™ã¹ãå…·ä½“çš„ãªé …ç›®ã§ã™ã€‚</p>



                <div class="card">

                    <h4>âœ… 1. å…±é€š: HTTPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè¨­å®š (Middleware)</h4>

                    <p>ã™ã¹ã¦ã®APIãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å¯¾ã—ã€ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼ã§ä»¥ä¸‹ã®ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ä»˜ä¸ã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…ã—ã¦ãã ã•ã„ã€‚</p>

                    <div class="table-responsive">

                        <table>

                            <thead>

                                <tr>

                                    <th>Header</th>

                                    <th>Valueã®ç”Ÿæˆå…ƒ</th>

                                    <th>ãƒ©ã‚¤ãƒ–ãƒ©ãƒªä¾‹ (JS/TS)</th>

                                </tr>

                            </thead>

                            <tbody>

                                <tr>

                                    <td><code>Authorization</code></td>

                                    <td><code>Bearer + [JWT]</code></td>

                                    <td>AsyncStorage / SecureStore</td>

                                </tr>

                                <tr>

                                    <td><code>X-Request-ID</code></td>

                                    <td>UUID v4 (ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ¯ã«ç”Ÿæˆ)</td>

                                    <td><code>uuid</code> npm package</td>

                                </tr>

                                <tr>

                                    <td><code>CF-Access-Client-Id</code></td>

                                    <td>ã‚¢ãƒ—ãƒªå†…å®šæ•° (Config)</td>

                                    <td><code>react-native-config</code></td>

                                </tr>

                            </tbody>

                        </table>

                    </div>

                    <div class="code-block">// Axios Interceptor Example
                        axiosInstance.interceptors.request.use(async (config) => {
                        const token = await SecureStore.getItemAsync('user_jwt');
                        config.headers.Authorization = `Bearer ${token}`;
                        config.headers['X-Request-ID'] = uuidv4();
                        return config;
                        });</div>

                </div>



                <div class="card">

                    <h4>âœ… 2. èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã®ç®¡ç†ãƒ­ã‚¸ãƒƒã‚¯</h4>

                    <p><strong>é‡è¦:</strong> ã‚¢ãƒ—ãƒªå´ã¯ã€Œè‡ªç¤¾ã®JWTã€ã®ã¿ã‚’ç®¡ç†ã—ã¾ã™ã€‚Slack/freeeã®ãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç†ã¯ã‚µãƒ¼ãƒãƒ¼å´ã®è²¬ä»»ã§ã‚ã‚Šã€ã‚¢ãƒ—ãƒªå´ã¯ä¸€åˆ‡é–¢ä¸ã—ã¾ã›ã‚“ã€‚</p>

                    <ul>

                        <li><strong>ä¿å­˜å ´æ‰€:</strong> <code>SecureStore</code> (Expo/React Native) ãªã©ã®OSæ¨™æº–æš—å·åŒ–é ˜åŸŸã€‚</li>

                        <li><strong>è‡ªå‹•æ›´æ–°:</strong> APIãŒ <code>401 Unauthorized</code> ã‚’è¿”ã—ãŸéš›ã€è‡ªå‹•çš„ã« <code>/api/auth/refresh</code> ã‚’å©ã„ã¦JWTã‚’æ›´æ–°ã—ã€å…ƒã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å†è©¦è¡Œã™ã‚‹ä»•çµ„ã¿ï¼ˆAxios Interceptorç­‰ï¼‰ã‚’å®Ÿè£…ã—ã¦ãã ã•ã„ã€‚</li>

                    </ul>

                </div>



                <div class="card">

                    <h4>âœ… 3. ç”»é¢ã”ã¨ã®å®Ÿè£…ã‚¿ã‚¹ã‚¯</h4>

                    <div class="table-responsive">

                        <table>

                            <thead>

                                <tr>

                                    <th>ç”»é¢</th>

                                    <th>å®Ÿè£…ã‚¿ã‚¹ã‚¯</th>

                                </tr>

                            </thead>

                            <tbody>

                                <tr>

                                    <td><strong>ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢</strong></td>

                                    <td>

                                        ãƒ»Google OAuth 2.0ã®Webviewå®Ÿè£…<br>

                                        ãƒ»èªè¨¼ã‚³ãƒ¼ãƒ‰ã‚’ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¸é€ä¿¡ (<code>POST /api/auth/google</code>)<br>

                                        ãƒ»è¿”å´ã•ã‚ŒãŸJWTã‚’Secure Storageã¸ä¿å­˜

                                    </td>

                                </tr>

                                <tr>

                                    <td><strong>ãƒ¡ã‚¤ãƒ³ç”»é¢</strong></td>

                                    <td>

                                        ãƒ»ç¾åœ¨æ™‚åˆ»ã®1ç§’æ›´æ–°ãƒ­ã‚¸ãƒƒã‚¯<br>

                                        ãƒ»èµ·å‹•æ™‚ã«ã€Œä»Šæ—¥ã®æ‰“åˆ»çŠ¶æ…‹ã€ã‚’å–å¾—ã—ã€ãƒœã‚¿ãƒ³ï¼ˆå‡ºå‹¤oré€€å‹¤ï¼‰ã‚’å‡ºã—åˆ†ã‘<br>

                                        ãƒ»æ‰“åˆ»ãƒœã‚¿ãƒ³æŠ¼ä¸‹æ™‚ã®APIé€ä¿¡ (<code>manual_timestamp: null</code>)

                                    </td>

                                </tr>

                                <tr>

                                    <td><strong>æ‰‹å‹•æ‰“åˆ»ãƒ¢ãƒ¼ãƒ€ãƒ«</strong></td>

                                    <td>

                                        ãƒ»DatePicker/TimePickerã®å®Ÿè£…<br>

                                        ãƒ»é¸æŠã•ã‚ŒãŸæ—¥æ™‚ã‚’ISO8601å½¢å¼ç­‰ã§APIé€ä¿¡ (<code>manual_timestamp: "..."</code>)

                                    </td>

                                </tr>

                                <tr>

                                    <td><strong>ä¼‘ã¿å ±å‘Šãƒ¢ãƒ¼ãƒ€ãƒ«</strong> <span class="badge new">New</span></td>

                                    <td>

                                        ãƒ»DatePickerã®å®Ÿè£…ï¼ˆå¯¾è±¡æ—¥é¸æŠï¼‰<br>

                                        ãƒ»ä¼‘æš‡ç¨®åˆ¥ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ï¼ˆæœ‰çµ¦ä¼‘æš‡ / æ¬ å‹¤ï¼‰ã®å®Ÿè£…<br>

                                        ãƒ»APIé€ä¿¡ (<code>POST /api/attendance/day-off</code>)

                                    </td>

                                </tr>

                            </tbody>

                        </table>

                    </div>

                </div>

            </section>



            <section>

                <h2>ğŸ’¾ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ (æ­£è¦åŒ–å¯¾å¿œ)</h2>

                <p>æ‹¡å¼µæ€§ã‚’è€ƒæ…®ã—ã€é€£æºãƒˆãƒ¼ã‚¯ãƒ³ã‚’åˆ¥ãƒ†ãƒ¼ãƒ–ãƒ«ã«åˆ‡ã‚Šå‡ºã™è¨­è¨ˆï¼ˆç¸¦æŒã¡ï¼‰ã«å¤‰æ›´ã—ã¾ã—ãŸã€‚</p>



                <h3>1. users ãƒ†ãƒ¼ãƒ–ãƒ« (å¾“æ¥­å“¡ãƒã‚¹ã‚¿)</h3>

                <div class="table-responsive">

                    <table>

                        <thead>

                            <tr>

                                <th>ç‰©ç†å</th>

                                <th>å‹</th>

                                <th>åˆ¶ç´„</th>

                                <th>èª¬æ˜</th>

                            </tr>

                        </thead>

                        <tbody>

                            <tr>

                                <td><code>user_id</code></td>

                                <td>UUID</td>

                                <td>PK</td>

                                <td>ã‚·ã‚¹ãƒ†ãƒ å†…éƒ¨ID</td>

                            </tr>

                            <tr>

                                <td><code>google_id</code></td>

                                <td>VARCHAR</td>

                                <td>UNIQUE</td>

                                <td>SSOç”¨ID</td>

                            </tr>

                            <tr>

                                <td><code>email</code></td>

                                <td>VARCHAR</td>

                                <td>UNIQUE</td>

                                <td>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</td>

                            </tr>

                            <tr>

                                <td><code>name</code></td>

                                <td>VARCHAR</td>

                                <td></td>

                                <td>è¡¨ç¤ºå</td>

                            </tr>

                        </tbody>

                    </table>

                </div>



                <h3>2. user_integrations ãƒ†ãƒ¼ãƒ–ãƒ« <span class="badge badge-new">New</span></h3>

                <p>å°†æ¥çš„ãªãƒ„ãƒ¼ãƒ«è¿½åŠ ï¼ˆLINE WORKSç­‰ï¼‰ã«æŸ”è»Ÿã«å¯¾å¿œã§ãã‚‹è¨­è¨ˆã§ã™ã€‚</p>

                <div class="table-responsive">

                    <table>

                        <thead>

                            <tr>

                                <th>ç‰©ç†å</th>

                                <th>å‹</th>

                                <th>èª¬æ˜</th>

                            </tr>

                        </thead>

                        <tbody>

                            <tr>

                                <td><code>id</code></td>

                                <td>BIGSERIAL</td>

                                <td>PK</td>

                            </tr>

                            <tr>

                                <td><code>user_id</code></td>

                                <td>UUID</td>

                                <td>FK (users)</td>

                            </tr>

                            <tr>

                                <td><code>provider</code></td>

                                <td>VARCHAR(20)</td>

                                <td>'slack', 'freee' ç­‰</td>

                            </tr>

                            <tr>

                                <td><code>access_token</code></td>

                                <td>TEXT</td>

                                <td><strong>AES-256æš—å·åŒ–</strong></td>

                            </tr>

                            <tr>

                                <td><code>refresh_token</code></td>

                                <td>TEXT</td>

                                <td><strong>AES-256æš—å·åŒ–</strong></td>

                            </tr>

                            <tr>

                                <td><code>expires_at</code></td>

                                <td>TIMESTAMP</td>

                                <td>æœ‰åŠ¹æœŸé™</td>

                            </tr>

                        </tbody>

                    </table>

                </div>



                <h3>3. attendance_logs ãƒ†ãƒ¼ãƒ–ãƒ« (æ‰“åˆ»å±¥æ­´)</h3>

                <div class="table-responsive">

                    <table>

                        <thead>

                            <tr>

                                <th>ç‰©ç†å</th>

                                <th>å‹</th>

                                <th>èª¬æ˜</th>

                            </tr>

                        </thead>

                        <tbody>

                            <tr>

                                <td><code>log_id</code></td>

                                <td>BIGSERIAL</td>

                                <td>PK</td>

                            </tr>

                            <tr>

                                <td><code>user_id</code></td>

                                <td>UUID</td>

                                <td>FK</td>

                            </tr>

                            <tr>

                                <td><code>request_id</code></td>

                                <td>VARCHAR</td>

                                <td><strong>å†ªç­‰æ€§ã‚­ãƒ¼ (Unique)</strong></td>

                            </tr>

                            <tr>

                                <td><code>stamped_at</code></td>

                                <td>TIMESTAMP</td>

                                <td><strong>é©ç”¨ã•ã‚Œã‚‹æ‰“åˆ»æ™‚åˆ»</strong> (æ‰‹å‹•æŒ‡å®š ã¾ãŸã¯ ã‚µãƒ¼ãƒãƒ¼æ™‚åˆ»)</td>

                            </tr>

                            <tr>

                                <td><code>created_at</code></td>

                                <td>TIMESTAMP</td>

                                <td><strong>ç›£æŸ»ç”¨ã‚·ã‚¹ãƒ†ãƒ æ™‚åˆ»</strong> (ãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆæ—¥æ™‚)</td>

                            </tr>

                            <tr>

                                <td><code>is_manual</code></td>

                                <td>BOOLEAN</td>

                                <td>æ‰‹å‹•å¤‰æ›´ãƒ•ãƒ©ã‚° (True:æ‰‹å‹• / False:è‡ªå‹•)</td>

                            </tr>

                            <tr>

                                <td><code>sync_status</code></td>

                                <td>VARCHAR</td>

                                <td>'pending', 'synced', 'failed'</td>

                            </tr>

                            <tr>

                                <td><code>action_type</code></td>

                                <td>VARCHAR(20)</td>

                                <td><span class="badge new">New</span> 'clock_in', 'clock_out', 'day_off'</td>

                            </tr>

                            <tr>

                                <td><code>leave_type</code></td>

                                <td>VARCHAR(20)</td>

                                <td><span class="badge new">New</span> 'paid_holiday', 'absence' (NULLable)</td>

                            </tr>

                        </tbody>

                    </table>

                </div>



                <h3>4. job_queue ãƒ†ãƒ¼ãƒ–ãƒ« <span class="badge badge-new">New</span></h3>

                <p>å¤–éƒ¨APIé€£æºã®ãƒªãƒˆãƒ©ã‚¤åˆ¶å¾¡ã‚’ç®¡ç†ã™ã‚‹ãƒ†ãƒ¼ãƒ–ãƒ«ã§ã™ã€‚</p>

                <div class="table-responsive">

                    <table>

                        <thead>

                            <tr>

                                <th>ç‰©ç†å</th>

                                <th>å‹</th>

                                <th>èª¬æ˜</th>

                            </tr>

                        </thead>

                        <tbody>

                            <tr>

                                <td><code>job_id</code></td>

                                <td>UUID</td>

                                <td>PK</td>

                            </tr>

                            <tr>

                                <td><code>job_type</code></td>

                                <td>VARCHAR(50)</td>

                                <td>'sync_to_freee' ç­‰</td>

                            </tr>

                            <tr>

                                <td><code>payload</code></td>

                                <td>JSONB</td>

                                <td>é€£æºã«å¿…è¦ãªãƒ‡ãƒ¼ã‚¿</td>

                            </tr>

                            <tr>

                                <td><code>status</code></td>

                                <td>VARCHAR(20)</td>

                                <td>'PENDING', 'PROCESSING', 'DONE', 'FAILED'</td>

                            </tr>

                            <tr>

                                <td><code>retry_count</code></td>

                                <td>INT</td>

                                <td>ãƒªãƒˆãƒ©ã‚¤å›æ•°</td>

                            </tr>

                            <tr>

                                <td><code>next_run_at</code></td>

                                <td>TIMESTAMP</td>

                                <td>æ¬¡å›å®Ÿè¡Œäºˆå®šæ—¥æ™‚</td>

                            </tr>

                        </tbody>

                    </table>

                </div>

            </section>



            <section>

                <h2>ğŸ“… é–‹ç™ºãƒ•ã‚§ãƒ¼ã‚ºæ¡ˆ</h2>

                <div class="table-responsive">

                    <table>

                        <thead>

                            <tr>

                                <th>ãƒ•ã‚§ãƒ¼ã‚º</th>

                                <th>ä¸»ãªä½œæ¥­å†…å®¹</th>

                                <th>æœŸé–“ç›®å®‰</th>

                            </tr>

                        </thead>

                        <tbody>

                            <tr>

                                <td><strong>Phase 0</strong></td>

                                <td>Cloudflare Tunnelè¨­å®šã€<strong>Docker Composeæ§‹ç¯‰</strong>ã€DBæ§‹ç¯‰(user_integrations, job_queueå«ã‚€)</td>

                                <td>3æ—¥</td>

                            </tr>

                            <tr>

                                <td><strong>Phase 1</strong></td>

                                <td>èªè¨¼åŸºç›¤ã€æ’ä»–åˆ¶å¾¡ãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£…</td>

                                <td>1é€±é–“</td>

                            </tr>

                            <tr>

                                <td><strong>Phase 2</strong></td>

                                <td>Slack/freeeé€£æºã€<strong>DBã‚¸ãƒ§ãƒ–ã‚­ãƒ¥ãƒ¼å®Ÿè£…</strong></td>

                                <td>2é€±é–“</td>

                            </tr>

                            <tr>

                                <td><strong>Phase 3</strong></td>

                                <td>ã‚¢ãƒ—ãƒªé–‹ç™º (ServiceTokenåŸ‹ã‚è¾¼ã¿ã€<strong>æ™‚åˆ»æŒ‡å®šUI</strong>)</td>

                                <td>3é€±é–“</td>

                            </tr>

                            <tr>

                                <td><strong>Phase 4</strong></td>

                                <td>ãƒ†ã‚¹ãƒˆ (ãƒªãƒˆãƒ©ã‚¤è©¦é¨“ã€ã‚ªãƒ•ãƒ©ã‚¤ãƒ³è©¦é¨“)</td>

                                <td>1é€±é–“</td>

                            </tr>

                        </tbody>

                    </table>

                </div>

            </section>



            <section>

                <h2>âœ… ã¾ã¨ã‚</h2>

                <div class="benefit-box">

                    <h3 style="color: #065f46; margin-bottom: 15px;">v3.4 æœ€çµ‚è¨­è¨ˆã®ãƒã‚¤ãƒ³ãƒˆ</h3>

                    <ul>

                        <li><strong>ã‚¢ãƒ—ãƒªå®Ÿè£…ã®æ˜ç¢ºåŒ–:</strong> ã‚¹ãƒãƒ›ã‚¢ãƒ—ãƒªãƒãƒ¼ãƒ ãŒå®Ÿè£…ã™ã¹ãã€Œãƒ˜ãƒƒãƒ€ãƒ¼å‡¦ç†ã€ã€Œãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç†ã€ã€Œç”»é¢ä»•æ§˜ã€ã‚’å…·ä½“çš„ã«ãƒªã‚¹ãƒˆåŒ–ã—ã¾ã—ãŸã€‚</li>

                        <li><strong>ç”»é¢ä»•æ§˜ã®å…·ä½“åŒ–:</strong> æ‰‹å‹•æ‰“åˆ»ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚„ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’æ˜ç¢ºåŒ–ã—ã€ã‚¢ãƒ—ãƒªé–‹ç™ºã®æŒ‡é‡ã‚’ç¢ºç«‹ã€‚</li>

                        <li><strong>APIä»•æ§˜ã®æ˜ç¢ºåŒ–:</strong> Slack/freeeã¸ã®æ¥ç¶šãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ­ã‚¸ãƒƒã‚¯ã‚’å…·ä½“åŒ–ã€‚</li>

                        <li><strong>è‡ªå¾‹çš„ãªãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç†:</strong> å¤–éƒ¨APIã®ãƒˆãƒ¼ã‚¯ãƒ³æ›´æ–°ã¯ã‚µãƒ¼ãƒãƒ¼ãŒè‡ªå‹•ã§è¡Œã†ãŸã‚ã€ã‚¢ãƒ—ãƒªå´ã®è² æ‹…ãŒã‚¼ãƒ­ã€‚</li>

                        <li><strong>å …ç‰¢æ€§ã¨æŸ”è»Ÿæ€§ã®ä¸¡ç«‹:</strong> ã‚»ã‚­ãƒ¥ã‚¢ãªé€šä¿¡çµŒè·¯ã¨ã€ç¾å ´ã®é‹ç”¨ã«å³ã—ãŸæ‰‹å‹•æ™‚åˆ»å¤‰æ›´æ©Ÿèƒ½ã€‚</li>

                    </ul>

                </div>

            </section>

        </div>



        <footer>

            <p>æ¥­å‹™ç”¨å‹¤æ€ æ‰“åˆ»ã‚·ã‚¹ãƒ†ãƒ  è¨­è¨ˆè³‡æ–™ v3.4</p>

            <p style="font-size: 0.9em; margin-top: 5px;">ä½œæˆæ—¥: 2026å¹´2æœˆ12æ—¥</p>

        </footer>

    </div>

</body>

</html>